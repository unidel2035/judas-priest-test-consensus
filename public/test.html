<!DOCTYPE html>
<html>
<head>
  <title>Notes API Test Page</title>
  <link rel="stylesheet" type="text/css" href="css/styles.css">
  <style>
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: #f9f9f9;
    }
    
    .message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    
    .success {
      background-color: #e6ffe6;
      border: 1px solid #00cc00;
      color: #006600;
    }
    
    .error {
      background-color: #ffe6e6;
      border: 1px solid #ff0000;
      color: #cc0000;
    }
    
    .test-btn {
      background-color: #28a745;
      margin: 5px;
    }
    
    .test-btn:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <h1>Notes API Test Page</h1>
  
  <div class="test-section">
    <h2>Test Controls</h2>
    <button id="create-test" class="test-btn">Create Test Note</button>
    <button id="load-all" class="test-btn">Load All Notes</button>
    <button id="clear-display" class="test-btn">Clear Display</button>
    <div id="message"></div>
  </div>
  
  <div id="notes-list"></div>

  <script>
    // Test note data
    const testNote = {
      title: 'Test Note',
      content: 'This is a test note created for testing purposes',
      tags: ['test', 'demo']
    };
    
    // DOM elements
    const messageDiv = document.getElementById('message');
    const notesList = document.getElementById('notes-list');
    
    // Display message function
    function displayMessage(text, isError = false) {
      messageDiv.textContent = text;
      messageDiv.className = 'message ' + (isError ? 'error' : 'success');
    }
    
    // Create note element with edit and delete buttons
    function createNoteElement(note) {
      const noteDiv = document.createElement('div');
      noteDiv.className = 'note';
      noteDiv.dataset.id = note._id;
      
      noteDiv.innerHTML = `
        <h2>${note.title}</h2>
        <p>${note.content}</p>
        <p><strong>Tags:</strong> ${note.tags.map(tag => tag.name).join(', ')}</p>
        <p><strong>Created:</strong> ${new Date(note.createdAt).toLocaleString()}</p>
        <button class="edit-btn" data-id="${note._id}">Edit</button>
        <button class="delete-btn" data-id="${note._id}">Delete</button>
      `;
      
      // Add event listeners for edit and delete buttons
      noteDiv.querySelector('.edit-btn').addEventListener('click', () => editNote(note._id));
      noteDiv.querySelector('.delete-btn').addEventListener('click', () => deleteNote(note._id));
      
      return noteDiv;
    }
    
    // Edit note function
    async function editNote(noteId) {
      try {
        const response = await fetch(`/api/notes/${noteId}`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const note = await response.json();
        
        // For demo purposes, just show an alert with note info
        alert(`Editing note: ${note.title}\nContent: ${note.content}\nTags: ${note.tags.map(tag => tag.name).join(', ')}`);
      } catch (error) {
        console.error('Error fetching note:', error);
        displayMessage(`Error fetching note: ${error.message}`, true);
      }
    }
    
    // Delete note function
    async function deleteNote(noteId) {
      if (!confirm('Are you sure you want to delete this test note?')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/notes/${noteId}`, {
          method: 'DELETE'
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        // Remove note from DOM
        const noteElement = document.querySelector(`.note[data-id="${noteId}"]`);
        if (noteElement) {
          noteElement.remove();
          displayMessage('Note deleted successfully');
        }
      } catch (error) {
        console.error('Error deleting note:', error);
        displayMessage(`Error deleting note: ${error.message}`, true);
      }
    }
    
    // Load all notes
    async function loadNotes() {
      try {
        displayMessage('Loading notes...');
        const response = await fetch('/api/notes');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const notes = await response.json();
        
        if (notes.length === 0) {
          notesList.innerHTML = '<p>No notes found.</p>';
          displayMessage('No notes found.');
          return;
        }
        
        notesList.innerHTML = '';
        notes.forEach(note => {
          const noteDiv = createNoteElement(note);
          notesList.appendChild(noteDiv);
        });
        
        displayMessage(`Loaded ${notes.length} notes`);
      } catch (error) {
        console.error('Error loading notes:', error);
        displayMessage(`Error loading notes: ${error.message}`, true);
        notesList.innerHTML = `<p class="error">Error loading notes: ${error.message}</p>`;
      }
    }
    
    // Create test note
    async function createTestNote() {
      try {
        displayMessage('Creating test note...');
        const response = await fetch('/api/notes', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(testNote)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const note = await response.json();
        
        // Add new note to DOM
        const noteDiv = createNoteElement(note);
        notesList.appendChild(noteDiv);
        
        displayMessage('Test note created successfully');
      } catch (error) {
        console.error('Error creating note:', error);
        displayMessage(`Error creating note: ${error.message}`, true);
      }
    }
    
    // Clear display
    function clearNotes() {
      notesList.innerHTML = '';
      displayMessage('Display cleared. Click "Load All Notes" to begin.');
    }
    
    // Event listeners
    document.getElementById('create-test').addEventListener('click', createTestNote);
    document.getElementById('load-all').addEventListener('click', loadNotes);
    document.getElementById('clear-display').addEventListener('click', clearNotes);
    
    // Load notes on page load
    loadNotes();
  </script>
</body>
</html>